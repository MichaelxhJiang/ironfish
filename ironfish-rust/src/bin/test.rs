use std::{
    ops::Add,
    thread,
    time::{Duration, Instant},
};

use ironfish_rust::mining::threadpool::ThreadPool;

fn main() {
    let batch_size = 10_000;

    let mut threadpool = ThreadPool::new(9, batch_size, true);

    let work: [u8; 208] = [
        0, 0, 0, 0, 0, 0, 0, 0, 40, 0, 0, 0, 0, 0, 0, 0, 0, 0, 41, 250, 115, 5, 50, 129, 40, 1,
        197, 31, 231, 204, 5, 175, 121, 168, 3, 118, 82, 45, 234, 106, 51, 88, 122, 208, 127, 151,
        57, 114, 12, 53, 136, 84, 97, 231, 149, 19, 59, 127, 70, 51, 143, 113, 141, 100, 62, 26,
        149, 16, 53, 0, 147, 103, 24, 114, 77, 21, 156, 16, 143, 66, 42, 0, 0, 0, 0, 0, 0, 0, 104,
        65, 42, 245, 148, 216, 13, 216, 214, 81, 165, 127, 77, 142, 186, 127, 55, 216, 132, 25,
        171, 15, 245, 249, 14, 101, 23, 206, 176, 214, 211, 219, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 123,
        0, 66, 201, 36, 67, 54, 176, 126, 177, 212, 202, 142, 137, 251, 100, 235, 127, 203, 222,
        99, 177, 192, 33, 131, 82, 50, 77, 161, 80, 37, 227, 245, 27, 129, 1, 0, 0, 0, 0, 0, 0,
        119, 53, 148, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0,
    ];

    let target: &[u8] = &[
        0, 0, 128, 255, 255, 86, 226, 7, 171, 46, 3, 140, 7, 121, 131, 187, 30, 13, 226, 86, 218,
        16, 149, 231, 62, 137, 133, 27, 117, 126, 209, 142,
    ];

    threadpool.new_work(&work, target, 1);

    let mut x = 0;
    let now = Instant::now();
    let end = now.add(Duration::from_secs(10));

    loop {
        loop {
            let blocks = threadpool.get_found_block();
            if blocks.is_some() {
                x += 1;
            } else {
                break;
            }
        }
        thread::sleep_ms(10);

        if Instant::now() > end {
            break;
        }
    }

    println!("Total hashes: {}", x * batch_size);
}
